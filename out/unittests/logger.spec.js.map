{"version":3,"sources":["../../src/unittests/logger.spec.ts"],"names":["description","SkipTestCase","Logger","paramsEquals","TestGroup","UnitTest","g","test","fn","t","mylog","testrec","testres","record","suite","path","res1","params2","res2","expect","spec","cases","length","params","logs","undefined","status","timems","res","a","_b","rec","start","finish","debug","Error","skipped","warn","fail","_logsCount"],"mappings":"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","sourcesContent":["export const description = `\nUnit tests for namespaced logging system.\n\nAlso serves as a larger test of async test functions, and of the logging system.\n`;\n\nimport { SkipTestCase } from '../common/framework/fixture.js';\nimport { Logger } from '../common/framework/logger.js';\nimport { paramsEquals } from '../common/framework/params_utils.js';\nimport { TestGroup } from '../common/framework/test_group.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = new TestGroup(UnitTest);\n\ng.test('construct').fn(t => {\n  const mylog = new Logger();\n  const [testrec, testres] = mylog.record({ suite: 'a', path: 'foo/bar' });\n  const [, res1] = testrec.record('baz', null);\n  const params2 = {};\n  const [, res2] = testrec.record('qux', params2);\n\n  t.expect(testres.spec === 'a:foo/bar:');\n  t.expect(testres.cases.length === 2);\n  t.expect(testres.cases[0] === res1);\n  t.expect(testres.cases[1] === res2);\n  t.expect(res1.test === 'baz');\n  t.expect(res1.params === null);\n  t.expect(res1.logs === undefined);\n  t.expect(res1.status === 'running');\n  t.expect(res1.timems < 0);\n  t.expect(res2.test === 'qux');\n  t.expect(paramsEquals(res2.params, params2));\n  t.expect(res2.logs === undefined);\n  t.expect(res2.status === 'running');\n  t.expect(res2.timems < 0);\n});\n\ng.test('private params').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: 'a', path: 'foo/bar' });\n  const [, res] = testrec.record('baz', { a: 1, _b: 2 });\n\n  t.expect(paramsEquals(res.params, { a: 1 }));\n});\n\ng.test('empty').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n  rec.finish();\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('pass').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  rec.debug(new Error('hello'));\n  t.expect(res.status === 'running');\n  rec.finish();\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('skip').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.skipped(new SkipTestCase());\n  rec.debug(new Error('hello'));\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'skip');\n  t.expect(res.timems >= 0);\n});\n\ng.test('warn').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'warn');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail').fn(t => {\n  const mylog = new Logger();\n  const [testrec] = mylog.record({ suite: '', path: '' });\n  const [rec, res] = testrec.record('baz', null);\n\n  rec.start();\n  t.expect(res.status === 'running');\n\n  rec.fail(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('debug')\n  .params([\n    { debug: true, _logsCount: 1 }, //\n    { debug: false, _logsCount: 0 },\n  ])\n  .fn(t => {\n    const { debug, _logsCount } = t.params;\n\n    const mylog = new Logger();\n    const [testrec] = mylog.record({ suite: '', path: '' });\n    const [rec, res] = testrec.record('baz', null);\n\n    rec.start(debug);\n    rec.debug(new Error('hello'));\n    rec.finish();\n    t.expect(res.status === 'pass');\n    t.expect(res.timems >= 0);\n    t.expect(res.logs!.length === _logsCount);\n  });\n"],"file":"logger.spec.js"}