{"version":3,"sources":["../../src/unittests/getStackTrace.spec.ts"],"names":["description","TestGroup","getStackTrace","UnitTest","g","test","params","case","_expectedLines","_stack","fn","t","lines","ex","Error","stack","expect","stringified","parts","split","length","fst","lst","indexOf"],"mappings":"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","sourcesContent":["export const description = `\nTests for getStackTrace.\n`;\n\nimport { TestGroup } from '../common/framework/test_group.js';\nimport { getStackTrace } from '../common/framework/util/stack.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = new TestGroup(UnitTest);\n\ng.test('stacks')\n  .params([\n    {\n      case: 'node_fail',\n      _expectedLines: 1,\n      _stack: `Error:\n   at CaseRecorder.fail (/Users/kainino/src/cts/src/common/framework/logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/logger.spec.ts:80:7)\n   at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n   at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n    },\n    {\n      // TODO: make sure this test case actually matches what happens on windows\n      case: 'node_fail_backslash',\n      _expectedLines: 1,\n      _stack: `Error:\n   at CaseRecorder.fail (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\common\\\\framework\\\\logger.ts:99:30)\n   at RunCaseSpecific.exports.g.test.t [as fn] (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\unittests\\\\logger.spec.ts:80:7)\n   at RunCaseSpecific.run (C:\\\\Users\\\\kainino\\\\src\\\\cts\\\\src\\\\common\\\\framework\\\\test_group.ts:121:18)\n   at processTicksAndRejections (internal\\\\process\\\\task_queues.js:86:5)`,\n    },\n    {\n      case: 'node_fail_processTicksAndRejections',\n      _expectedLines: 3,\n      _stack: `Error: expectation had no effect: suite1:foo:\n    at Object.generateMinimalQueryList (/Users/kainino/src/cts/src/common/framework/generate_minimal_query_list.ts:72:24)\n    at testGenerateMinimalQueryList (/Users/kainino/src/cts/src/unittests/loading.spec.ts:289:25)\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\n    at RunCaseSpecific.fn (/Users/kainino/src/cts/src/unittests/loading.spec.ts:300:3)\n    at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:144:9)\n    at /Users/kainino/src/cts/src/common/runtime/cmdline.ts:62:25\n    at async Promise.all (index 29)\n    at /Users/kainino/src/cts/src/common/runtime/cmdline.ts:78:5`,\n    },\n    {\n      case: 'node_throw',\n      _expectedLines: 1,\n      _stack: `Error: hello\n    at RunCaseSpecific.g.test.t [as fn] (/Users/kainino/src/cts/src/unittests/test_group.spec.ts:51:11)\n    at RunCaseSpecific.run (/Users/kainino/src/cts/src/common/framework/test_group.ts:121:18)\n    at processTicksAndRejections (internal/process/task_queues.js:86:5)`,\n    },\n    {\n      case: 'firefox_fail',\n      _expectedLines: 1,\n      _stack: `fail@http://localhost:8080/out/common/framework/logger.js:104:30\nexpect@http://localhost:8080/out/common/framework/default_fixture.js:59:16\n@http://localhost:8080/out/unittests/util.spec.js:35:5\nrun@http://localhost:8080/out/common/framework/test_group.js:119:18`,\n    },\n    {\n      case: 'firefox_throw',\n      _expectedLines: 1,\n      _stack: `@http://localhost:8080/out/unittests/test_group.spec.js:48:11\nrun@http://localhost:8080/out/common/framework/test_group.js:119:18`,\n    },\n    {\n      case: 'safari_fail',\n      _expectedLines: 1,\n      _stack: `fail@http://localhost:8080/out/common/framework/logger.js:104:39\nexpect@http://localhost:8080/out/common/framework/default_fixture.js:59:20\nhttp://localhost:8080/out/unittests/util.spec.js:35:11\nhttp://localhost:8080/out/common/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n    },\n    {\n      case: 'safari_throw',\n      _expectedLines: 1,\n      _stack: `http://localhost:8080/out/unittests/test_group.spec.js:48:20\nhttp://localhost:8080/out/common/framework/test_group.js:119:20\nasyncFunctionResume@[native code]\n[native code]\npromiseReactionJob@[native code]`,\n    },\n    {\n      case: 'chrome_fail',\n      _expectedLines: 1,\n      _stack: `Error\n    at CaseRecorder.fail (http://localhost:8080/out/common/framework/logger.js:104:30)\n    at DefaultFixture.expect (http://localhost:8080/out/common/framework/default_fixture.js:59:16)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/util.spec.js:35:5)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n    {\n      case: 'chrome_throw',\n      _expectedLines: 5,\n      _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n    {\n      case: 'multiple_lines',\n      _expectedLines: 7,\n      _stack: `Error: hello\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:48:11)\n    at RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:18)\"\n    at async Promise.all (index 0)\n    at async TestGroupTest.run (http://localhost:8080/out/unittests/test_group_test.js:6:5)\n    at async RunCaseSpecific.fn (http://localhost:8080/out/unittests/test_group.spec.js:53:15)\n    at async RunCaseSpecific.run (http://localhost:8080/out/common/framework/test_group.js:119:7)\n    at async runCase (http://localhost:8080/out/common/runtime/standalone.js:37:17)\n    at async http://localhost:8080/out/common/runtime/standalone.js:102:7`,\n    },\n  ])\n  .fn(t => {\n    const lines: number = t.params._expectedLines;\n\n    const ex = new Error();\n    ex.stack = t.params._stack;\n    t.expect(ex.stack === t.params._stack);\n    const stringified = getStackTrace(ex);\n    const parts = stringified.split('\\n');\n\n    t.expect(parts.length === lines);\n    const fst = parts[0];\n    const lst = parts[parts.length - 1];\n    t.expect(fst.indexOf('/unittests/') !== -1 || fst.indexOf('\\\\unittests\\\\') !== -1);\n    t.expect(lst.indexOf('/unittests/') !== -1 || lst.indexOf('\\\\unittests\\\\') !== -1);\n  });\n"],"file":"getStackTrace.spec.js"}